<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirGuardian - Air Quality Intelligence</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .demo-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .city-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .city-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .city-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .city-btn.active {
            background: #764ba2;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .aqi-display {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
        }

        .aqi-good { background: #00e400; color: white; }
        .aqi-moderate { background: #ffff00; color: #333; }
        .aqi-usg { background: #ff7e00; color: white; }
        .aqi-unhealthy { background: #ff0000; color: white; }
        .aqi-very-unhealthy { background: #8f3f97; color: white; }
        .aqi-hazardous { background: #7e0023; color: white; }

        .forecast-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
        }

        .recommendations {
            list-style: none;
        }

        .recommendations li {
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .policy-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .policy-card h3 {
            color: white;
        }

        .priority-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .priority-low { background: #00e400; }
        .priority-medium { background: #ff7e00; }
        .priority-high { background: #ff0000; }
        .priority-critical { background: #7e0023; }

        .api-demo {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
        }

        .api-demo pre {
            margin: 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .chart-container {
            margin-top: 20px;
            height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç AirGuardian</h1>
            <p>AI-Powered Air Quality Intelligence | NASA Space Apps Challenge 2024</p>
        </div>

        <div class="demo-section">
            <h2>Select City</h2>
            <div class="city-selector">
                <button class="city-btn active" onclick="loadCity('Cairo')">Cairo</button>
                <button class="city-btn" onclick="loadCity('Alexandria')">Alexandria</button>
                <button class="city-btn" onclick="loadCity('Giza')">Giza</button>
                <button class="city-btn" onclick="loadCity('Aswan')">Aswan</button>
            </div>
        </div>

        <div id="content">
            <div class="loading">Loading data...</div>
        </div>

        <div class="demo-section">
            <h2>API Integration Example</h2>
            <p style="margin-bottom: 15px;">Your app can integrate AirGuardian with simple REST API calls:</p>
            <div class="api-demo">
                <pre>
// Fetch 24-hour forecast
fetch('http://localhost:8000/api/v1/forecast/Cairo?hours=24')
  .then(res => res.json())
  .then(data => {
    console.log('Forecast:', data);
    // Display in your app
  });

// Get health recommendations
fetch('http://localhost:8000/api/v1/health-alert/Cairo')
  .then(res => res.json())
  .then(data => {
    console.log('Health Alert:', data);
  });

// Government policy recommendations
fetch('http://localhost:8000/api/v1/policy-recommendations/Cairo')
  .then(res => res.json())
  .then(data => {
    console.log('Policy Actions:', data);
  });
                </pre>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let currentCity = 'Cairo';

        async function loadCity(city) {
            currentCity = city;
            
            // Update button states
            document.querySelectorAll('.city-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === city) {
                    btn.classList.add('active');
                }
            });

            // Show loading
            document.getElementById('content').innerHTML = '<div class="loading">Loading data...</div>';

            try {
                // Fetch all data
                const [current, forecast, health, policy] = await Promise.all([
                    fetch(`${API_BASE}/current/${city}`).then(r => r.json()),
                    fetch(`${API_BASE}/forecast/${city}?hours=12`).then(r => r.json()),
                    fetch(`${API_BASE}/health-alert/${city}`).then(r => r.json()),
                    fetch(`${API_BASE}/policy-recommendations/${city}`).then(r => r.json())
                ]);

                displayData(current, forecast, health, policy);
            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="demo-section">
                        <h3 style="color: #ff0000;">‚ö†Ô∏è API Connection Error</h3>
                        <p>Make sure the FastAPI server is running:</p>
                        <div class="api-demo">
                            <pre>python main.py</pre>
                        </div>
                        <p style="margin-top: 15px;">Using mock data instead...</p>
                    </div>
                `;
                
                // Use mock data
                displayMockData(city);
            }
        }

        function displayData(current, forecast, health, policy) {
            const aqiClass = getAQIClass(current.aqi);
            
            const html = `
                <div class="dashboard">
                    <div class="card">
                        <h3>Current Air Quality - ${current.location}</h3>
                        <div class="aqi-display ${aqiClass}">
                            ${current.aqi}
                            <div style="font-size: 0.3em; margin-top: 10px;">${current.risk_level}</div>
                        </div>
                        <p><strong>PM2.5:</strong> ${current.pm25.toFixed(1)} Œºg/m¬≥</p>
                        <p><strong>NO2:</strong> ${current.no2.toFixed(1)} ppb</p>
                        <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                            Data from TEMPO Satellite + Ground Sensors
                        </p>
                    </div>

                    <div class="card">
                        <h3>Health Recommendations</h3>
                        <p><strong>Risk Level:</strong> ${health.risk_level}</p>
                        
                        <p style="margin-top: 15px;"><strong>‚úÖ Safe Activities:</strong></p>
                        <ul style="padding-left: 20px;">
                            ${health.activities_safe.map(a => `<li>${a}</li>`).join('')}
                        </ul>
                        
                        ${health.activities_avoid.length > 0 ? `
                            <p style="margin-top: 15px;"><strong>‚ö†Ô∏è Avoid:</strong></p>
                            <ul style="padding-left: 20px;">
                                ${health.activities_avoid.map(a => `<li>${a}</li>`).join('')}
                            </ul>
                        ` : ''}
                        
                        <p style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; font-size: 0.9em;">
                            <strong>Note:</strong> ${health.sensitive_groups_warning}
                        </p>
                    </div>

                    <div class="card policy-card">
                        <h3>Government Policy Recommendations</h3>
                        <div class="priority-badge priority-${policy.priority.toLowerCase()}">
                            ${policy.priority} PRIORITY
                        </div>
                        
                        <p><strong>Forecast Severity:</strong> ${policy.forecast_severity}</p>
                        
                        <p style="margin-top: 15px;"><strong>Recommended Actions:</strong></p>
                        <ul class="recommendations">
                            ${policy.recommendations.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                        
                        <p style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px;">
                            <strong>Impact:</strong> ${policy.estimated_impact}
                        </p>
                    </div>
                </div>

                <div class="demo-section">
                    <h2>12-Hour Forecast</h2>
                    <div id="forecast-list">
                        ${forecast.slice(0, 6).map((f, i) => {
                            const time = new Date(f.timestamp).toLocaleTimeString('en-US', { 
                                hour: 'numeric', 
                                hour12: true 
                            });
                            return `
                                <div class="forecast-item">
                                    <span><strong>${time}</strong></span>
                                    <span>AQI: <strong>${f.aqi}</strong> (${f.risk_level})</span>
                                    <span>Confidence: ${(f.confidence * 100).toFixed(0)}%</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;

            document.getElementById('content').innerHTML = html;
        }

        function displayMockData(city) {
            const mockAQI = { Cairo: 145, Alexandria: 95, Giza: 130, Aswan: 70 }[city] || 100;
            const mockData = {
                current: {
                    location: city,
                    aqi: mockAQI,
                    risk_level: getRiskLevel(mockAQI),
                    pm25: mockAQI * 0.4,
                    no2: mockAQI * 0.3
                },
                forecast: Array.from({ length: 6 }, (_, i) => ({
                    timestamp: new Date(Date.now() + i * 3600000).toISOString(),
                    aqi: mockAQI + Math.floor(Math.random() * 20 - 10),
                    risk_level: getRiskLevel(mockAQI),
                    confidence: 0.85
                })),
                health: {
                    risk_level: getRiskLevel(mockAQI),
                    activities_safe: mockAQI < 100 ? ['Walking', 'Running', 'Cycling'] : ['Indoor activities'],
                    activities_avoid: mockAQI > 100 ? ['Outdoor sports', 'Prolonged activity'] : [],
                    sensitive_groups_warning: mockAQI > 100 ? 
                        'Sensitive groups should limit exposure' : 
                        'Air quality is good for everyone'
                },
                policy: {
                    priority: mockAQI > 150 ? 'HIGH' : mockAQI > 100 ? 'MEDIUM' : 'LOW',
                    forecast_severity: getRiskLevel(mockAQI),
                    recommendations: mockAQI > 150 ? 
                        ['Issue public advisory', 'Increase public transport', 'Monitor emissions'] :
                        ['Continue monitoring'],
                    estimated_impact: 'Normal conditions'
                }
            };

            displayData(mockData.current, mockData.forecast, mockData.health, mockData.policy);
        }

        function getRiskLevel(aqi) {
            if (aqi <= 50) return 'Good';
            if (aqi <= 100) return 'Moderate';
            if (aqi <= 150) return 'Unhealthy for Sensitive Groups';
            if (aqi <= 200) return 'Unhealthy';
            if (aqi <= 300) return 'Very Unhealthy';
            return 'Hazardous';
        }

        function getAQIClass(aqi) {
            if (aqi <= 50) return 'aqi-good';
            if (aqi <= 100) return 'aqi-moderate';
            if (aqi <= 150) return 'aqi-usg';
            if (aqi <= 200) return 'aqi-unhealthy';
            if (aqi <= 300) return 'aqi-very-unhealthy';
            return 'aqi-hazardous';
        }

        // Load Cairo by default
        loadCity('Cairo');
    </script>
</body>
</html>